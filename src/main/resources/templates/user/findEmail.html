<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/Layout4Encounter}">
    <head>
    	<title>이메일 아이디 찾기</title>
    </head>
	<section layout:fragment="contents" class="contents">
		<article class="group-article d-flex flex-column justify-content-center align-items-center">
			<div class="group-inputs-sign-up">
<!-- 홈페이지 메인 타이틀 심볼__Start-->					
				<div class="main-title mt-2 mb-5">
					<div class="svg-angry-puppy col-1">
						<svg width="204" height="124" viewBox="0 0 204 124" fill="none"
							xmlns="http://www.w3.org/2000/svg">
								<path d="M45.8911 53.1721C45.8911 11.0479 87.8162 1.48308 109.063 1C130.31 1 171.666 9.88855 171.666 53.1721C171.666 96.4556 130.31 100.513 109.063 100.513C87.8162 100.03 45.8911 95.2962 45.8911 53.1721Z" fill="white" />
								<path d="M128.748 47.1321C131.683 41.8847 138.503 37.1648 145.105 36.4388C150.693 35.8242 159.921 38.3595 158.072 47.7269C156.223 57.0944 146.875 61.3569 134.198 58.9741C127.193 57.6573 124.573 54.595 128.748 47.1321Z" fill="white" />
								<path d="M101.98 56.5616C101.98 52.0206 96.0312 44.9517 86.6831 41.6346C77.3349 38.3175 64.5874 38.9088 64.5874 44.9517C64.5874 52.1773 68.4869 56.7011 79.8844 59.8787C85.8332 61.5373 101.98 65.1295 101.98 56.5616Z" fill="white" />
								<path d="M116.465 62.3666C126.663 62.3666 128.646 68.448 128.363 72.3179C126.663 76.4643 122.584 78.9521 116.465 78.9521C110.347 78.9521 105.7 76.1879 105.417 72.3179C105.134 68.448 106.267 62.3666 116.465 62.3666Z" fill="white" />
								<path d="M45.8911 53.1721C45.8911 11.0479 87.8162 1.48308 109.063 1C130.31 1 171.666 9.88855 171.666 53.1721C171.666 96.4556 130.31 100.513 109.063 100.513C87.8162 100.03 45.8911 95.2962 45.8911 53.1721Z" stroke="black" stroke-width="2" />
								<path d="M128.748 47.1321C131.683 41.8847 138.503 37.1648 145.105 36.4388C150.693 35.8242 159.921 38.3595 158.072 47.7269C156.223 57.0944 146.875 61.3569 134.198 58.9741C127.193 57.6573 124.573 54.595 128.748 47.1321Z" stroke="black" stroke-width="2" />
								<path d="M101.98 56.5616C101.98 52.0206 96.0312 44.9517 86.6831 41.6346C77.3349 38.3175 64.5874 38.9088 64.5874 44.9517C64.5874 52.1773 68.4869 56.7011 79.8844 59.8787C85.8332 61.5373 101.98 65.1295 101.98 56.5616Z" stroke="black" stroke-width="2" />
								<path d="M116.465 62.3666C126.663 62.3666 128.646 68.448 128.363 72.3179C126.663 76.4643 122.584 78.9521 116.465 78.9521C110.347 78.9521 105.7 76.1879 105.417 72.3179C105.134 68.448 106.267 62.3666 116.465 62.3666Z" stroke="black" stroke-width="2" />
								<path d="M188.93 88.8542C206.319 79.2144 178.931 33.567 166.306 14.1538C147.924 -4.02659 149.174 13.1499 157.535 29.0493C175.371 62.9687 165.016 73.7606 164.248 84.2699C165.571 89.509 171.54 98.494 188.93 88.8542Z" fill="white" stroke="black" stroke-width="2" />
								<path d="M24.4399 113.892C1.324 102.911 25.6991 49.0323 40.7761 23.4656C65.488 -4.33617 69.6221 25.243 61.0289 46.3734C54.1543 63.2777 55.7797 94.0831 57.4517 107.373C56.0794 114.122 47.5557 124.874 24.4399 113.892Z" fill="white" stroke="black" stroke-width="2" />
								<path d="M102.251 30.7821C98.0529 24.0626 92.2613 27.9783 89.8902 30.7761M88.3834 10.9514C91.7827 20.9027 85.2673 24.4963 81.5847 25.0491M96.0748 9.95166C96.4519 20.4348 103.843 21.5812 107.492 20.8439" stroke="black" stroke-width="2" />
							</svg>
					</div>
					<div class="text-main-title col-11 w-100 my-auto ">간식줘집사</div>
				</div>
<!-- 홈페이지 메인 타이틀 심볼__End-->

				<div class="mt-1">
				<!-- 코드 Input -->
					<div class="column-input-sign-up d-flex">
						<!-- 원형 아이콘 -->
						<div>
							<svg width="96" height="87" viewBox="0 0 96 87" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M72 43C72 56.2548 61.2548 67 48 67C34.7452 67 24 56.2548 24 43C24 29.7452 34.7452 19 48 19C61.2548 19 72 29.7452 72 43ZM31.4965 43C31.4965 52.1146 38.8854 59.5035 48 59.5035C57.1146 59.5035 64.5035 52.1146 64.5035 43C64.5035 33.8854 57.1146 26.4965 48 26.4965C38.8854 26.4965 31.4965 33.8854 31.4965 43Z" fill="white"/>
								<path d="M48 19C51.1517 19 54.2726 19.6208 57.1844 20.8269C60.0962 22.033 62.742 23.8008 64.9706 26.0294C67.1992 28.258 68.967 30.9038 70.1731 33.8156C71.3792 36.7274 72 39.8483 72 43C72 46.1517 71.3792 49.2726 70.1731 52.1844C68.967 55.0962 67.1992 57.742 64.9706 59.9706C62.742 62.1992 60.0962 63.967 57.1844 65.1731C54.2726 66.3792 51.1517 67 48 67L48 59.5035C50.1673 59.5035 52.3133 59.0766 54.3156 58.2473C56.3179 57.4179 58.1372 56.2022 59.6697 54.6697C61.2022 53.1373 62.4179 51.3179 63.2472 49.3156C64.0766 47.3133 64.5035 45.1673 64.5035 43C64.5035 40.8327 64.0766 38.6867 63.2473 36.6844C62.4179 34.6821 61.2022 32.8628 59.6697 31.3303C58.1372 29.7978 56.3179 28.5821 54.3156 27.7527C52.3133 26.9234 50.1673 26.4965 48 26.4965L48 19Z" fill="#68FFA2"/>
							</svg>
						</div>
						<!-- Input -->
						<input id="find-email" type="text" class="input-sign-up" placeholder="가입하신 이메일을 입력하세요.">
					</div>
				</div>
				<div class="group-warning-text">
					<span id="text-warning-sign-up" ></span>
				</div>
			</div>
			<!-- 입력하기 버튼 -->
			<button id="btn-find-email" class="btn-verification">
				가입 이메일 입력하기
			</button>
		</article>
	</section>

	<th:block layout:fragment="script">
    	<script th:inline="javascript">
    	$(document).ready(function(){
    		
    		/* input 태그에서 바로 EnterKey를 눌렀을 때 */
			$("input").on('keyup', function(key){
				if(key.keyCode == 13){
					$("#btn-find-email").trigger('click');
				}
			})// .input on keyup
    		
    		$("#btn-find-email").on('click', function(){
    			let emailTyped = $("#find-email").val().trim();
    			
    			if(!emailTyped){
    				$("#text-warning-sign-up").text("🚫이메일을 입력하세요.");
    				return;
    			}

    			let regexpEmail = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
    			if(!regexpEmail.test(emailTyped)){
    				$("#text-warning-sign-up").text("🛑올바른 이메일 형식을 입력하세요.");
    				$("#find-email").val('');
    				return;
    			}
    			
    			
    			let url = "/user/verify-loginId"
    			let params = {"emailTyped" : emailTyped}
    			
    			$.post(url, params)
    			.done(function(data){
    				if(data.code == 200){
    					let loginIdFound = data.email;
    					console.log(loginIdFound)
    					if(confirm(`해당 아이디는 ${loginIdFound}입니다. \n비밀번호를 찾으시겠습니까? \n해당 이메일로 인증 코드를 보내드립니다.`) == false){
    	    				location.href="/user/sign-in-view";
    	    				return;
    	    			}
    					
    					let paramEmail = {"userEmail": loginIdFound};
    					
    					/* 해당 이메일로 인증 코드를 보내기 */
    					$.post("/user/email-verification", paramEmail)
    					.done(function(data){
    						if(data.code == 200){
		    					alert(`인증 코드를 보내드렸습니다. \n${loginIdFound} \n이메일을 확인해주세요.`);
		    					location.href = "/user/verify-code-view";
    						} else{
    							alert(data.error_message);
    							location.href = "/user/sign-in-view";
    						}
    					})
    				} else {
    					alert(data.error_message);
    					location.reload();
    				}
    			})// ajax
    			
    		})// btn-sign-up.on click
    		
    	}) // document.ready
    	</script>
	</th:block>
	
</html>