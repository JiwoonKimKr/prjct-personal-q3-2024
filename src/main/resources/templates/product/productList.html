<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/defaultLayout}">
      
	<head>
		<title>간식줘집사</title>
	</head>
	<section layout:fragment="contents" class="contents">
		<article class="group-article background-cards-list">
			<div class="groups-dropdown-select">
				<div class="group-dropdown-select">
					<label for="field-agePetProper" class="label-for-select m-0">
						연령별 분류
					</label>
				  	<select id="field-agePetProper" name="agePetProper" class="btn-select-dropdown-specific custom-select">
					    <option data-field="agePetProper">
					    	---선택---
				    	</option>
					    <option data-field="agePetProper">
					    	전체
				    	</option>
					    <option class="under6months" data-field="agePetProper" data-value="under6months">
					    	6개월 미만
				    	</option>
					    <option class="adult" data-field="agePetProper" data-value="adult">
					    	성견
				    	</option>
					    <option class="senior" data-field="agePetProper" data-value="senior">
					    	고령견
				    	</option>
			  		</select>
				</div>
				<div class="group-dropdown-select">
					<label for="field-category" class="label-for-select m-0">
						카테고리
					</label>
				  	<select id="field-category" name="category" class="btn-select-dropdown-specific custom-select">
					    <option data-field="category">
					    	---선택---
				    	</option>
					    <option data-field="category">
					    	전체
				    	</option>
					    <option class="treat" data-field="category" data-value="treat">
					    	간식
				    	</option>
					    <option class="kibble" data-field="category" data-value="kibble">
					    	사료
				    	</option>
			  		</select>
				</div>
			</div>
			<div class="group-btns-paging">
<!-- 전 페이지 화살표; btn-pref-page-->			
				<button data-direction="prev" id="btn-prev-page" class="arrow-paging">
					<svg width="49" height="56" viewBox="0 0 49 56" fill="none" xmlns="http://www.w3.org/2000/svg">
						<g filter="url(#filter0_d_373_4)">
							<path d="M0 26L45 51.9808V0.0192375L0 26Z" fill="#FF6868"/>
						</g>
						<defs>
							<filter id="filter0_d_373_4" x="0" y="0.0192871" width="49" height="55.9614" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
								<feFlood flood-opacity="0" result="BackgroundImageFix"/>
								<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
								<feOffset dx="4" dy="4"/>
								<feComposite in2="hardAlpha" operator="out"/>
								<feColorMatrix type="matrix" values="0 0 0 0 0.45098 0 0 0 0 0.317647 0 0 0 0 0.929412 0 0 0 1 0"/>
								<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_373_4"/>
								<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_373_4" result="shape"/>
							</filter>
						</defs>
					</svg>
				</button>
				<div class="list-indices-page d-flex justify-content-center align-items-center">
				</div>
				
<!-- 다음 페이지 화살표; btn-next-page -->					
				<button data-direction="next" id="btn-next-page" class="arrow-paging">
					<svg width="49" height="56" viewBox="0 0 49 56" fill="none" xmlns="http://www.w3.org/2000/svg">
						<g filter="url(#filter0_d_373_2)">
							<path d="M45 26L0 51.9808V0.0192375L45 26Z" fill="#FF6868"/>
						</g>
						<defs>
						<filter id="filter0_d_373_2" x="0" y="0.0192871" width="49" height="55.9614" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
							<feFlood flood-opacity="0" result="BackgroundImageFix"/>
							<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
							<feOffset dx="4" dy="4"/>
							<feComposite in2="hardAlpha" operator="out"/>
							<feColorMatrix type="matrix" values="0 0 0 0 0.45098 0 0 0 0 0.317647 0 0 0 0 0.929412 0 0 0 1 0"/>
							<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_373_2"/>
							<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_373_2" result="shape"/>
						</filter>
						</defs>
					</svg>
				</button>
							
			</div>
			<div class="groups-cards-collapsed">
<!-- 사용자 추천 아이템;현재는 로그인한 경우에만 띄우도록 작성_25 08 2024 -->			
				<div class="groups-product-list-recommended" th:if="${listProductsRecommended}">
					<th:block th:each="unit : ${listProductsRecommended}">
<!-- 추천 unit의 경우 240px X 240px -->					
						<div class="unit-card-product-recommended">
							<div class="icon-red-spangle">
								<svg width="35" height="35" viewBox="0 0 35 35" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M15.8537 1.16185C16.4046 -0.387286 18.5954 -0.387283 19.1463 1.16185L20.8635 5.9907C21.2104 6.96626 22.3248 7.42785 23.2599 6.98334L27.8887 4.78307C29.3737 4.07721 30.9228 5.62635 30.2169 7.1113L28.0167 11.7401C27.5721 12.6752 28.0337 13.7896 29.0093 14.1365L33.8381 15.8537C35.3873 16.4046 35.3873 18.5954 33.8381 19.1463L29.0093 20.8635C28.0337 21.2104 27.5721 22.3248 28.0167 23.2599L30.2169 27.8887C30.9228 29.3737 29.3736 30.9228 27.8887 30.2169L23.2599 28.0167C22.3248 27.5721 21.2104 28.0337 20.8635 29.0093L19.1463 33.8381C18.5954 35.3873 16.4046 35.3873 15.8537 33.8381L14.1365 29.0093C13.7896 28.0337 12.6752 27.5721 11.7401 28.0167L7.1113 30.2169C5.62635 30.9228 4.07721 29.3736 4.78308 27.8887L6.98334 23.2599C7.42785 22.3248 6.96626 21.2104 5.9907 20.8635L1.16185 19.1463C-0.387286 18.5954 -0.387283 16.4046 1.16185 15.8537L5.9907 14.1365C6.96626 13.7896 7.42785 12.6752 6.98334 11.7401L4.78307 7.1113C4.07721 5.62635 5.62635 4.07721 7.1113 4.78308L11.7401 6.98334C12.6752 7.42785 13.7896 6.96626 14.1365 5.9907L15.8537 1.16185Z" fill="#ED5178"/>
								</svg>
							</div>
							<a class="d-flex justify-content-center my-2" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
								<img class="img-unit-list-view" th:src="${unit.imgProfile}" width="180" height="180">
							</a>
							<div class="group-link-from-unit-recommended">
								<a class="name-unit-list-view-recommended anchor-unit-list-view-recommended" th:data-field="name" th:data-value="${unit.name}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.name}"></span>
								</a>
								<a class="category-unit-list-view-recommended anchor-unit-list-view-recommended" th:data-field="category" th:data-value="${unit.category}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.categoryTranslatedK}"></span>
								</a>
								<a class="agePetProper-unit-list-view-recommended anchor-unit-list-view-recommended" th:data-field="agePetProper" th:data-value="${unit.agePetProper}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.agePetProperTranslatedK}"></span>
								</a>
							</div>
						</div>
					</th:block>
				</div>
				<div class="groups-product-list">
					<th:block th:each="unit : ${listProducts}">
<!-- 하나의 Card Unit이 320px X 320px; -->
						<div class="unit-card-product">
							<a th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
								<img class="img-unit-list-view" th:src="${unit.imgProfile}" width="270" height="270">
							</a>
							<div class="group-link-from-unit">
								<a class="name-unit-list-view anchor-unit-list-view" th:data-field="name" th:data-value="${unit.name}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.name}"></span>
								</a>
								<a class="category-unit-list-view anchor-unit-list-view" th:data-field="category" th:data-value="${unit.category}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.categoryTranslatedK}"></span>
								</a>
								<a class="agePetProper-unit-list-view anchor-unit-list-view" th:data-field="agePetProper" th:data-value="${unit.agePetProper}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.agePetProperTranslatedK}"></span>
								</a>
							</div>
						</div>
					</th:block>
				</div>
			</div>
		</article>
</section>

	<th:block layout:fragment="script">
    	<script th:inline="javascript">
    		$(document).ready(function(e){
    			let numberPageCurrent = /*[[${numberPageCurrent}]]*/null;
    			let numberPageMax = /*[[${numberPageMax}]]*/null;
    			let limit = /*[[${limit}]]*/null;
    			let idFirst = /*[[${idFirst}]]*/null;
    			let idLast = /*[[${idLast}]]*/null;
    			
    			console.log(`numberPageCurrent: ${numberPageCurrent}`);
    			console.log(`numberPageMax: ${numberPageMax}`);
    			console.log(`limit: ${limit}`);
    			console.log(`idFirst: ${idFirst}`);
    			console.log(`idLast :${idLast}`);
    			
    			updateFilteringsCurrentPage();
    			
    			indexingPagingButtons();
    			updatePagingIndices();
    			
    			function updateFilteringsCurrentPage(){
    				/* 처음 페이지 로딩 될 때, 해당 옵션 필터들 띄우기; option:selected 노출시키기 */
        			let link = window.location.href;
    				let url = new URL(link.toString());
    				let urlParams = url.searchParams;
    				
    				//나중에 여러 Field(Select메뉴)들이 있는 경우, 반복문으로 돌려야!
    				let keys = urlParams.keys();
    				for(let key of keys){
    					if(key == 'direction'
    						|| key == 'idRequested'
    						|| key == 'pageCurrent'
    						|| key == 'pageRequested') {
    						continue;
    					}
    					let value = urlParams.get(key);
    					//console.log(`key: ${key}, value: ${value}`);
    					let selectCur = $(`#field-${key}`);
    					let optionToFind = $(`[data-value=${value}]`);
    					selectCur.find(optionToFind).prop('selected', true);
    				}
    			}
				
				function indexingPagingButtons(){
					/* 페이지 버튼; btn-prev-page btn-next-page data로 최소 최대 id값 넣기*/
					let listProducts = /*[[${listProducts}]]*/null;
					//console.log(listProducts);
					
					if(listProducts.length < 1){
						alert("해당 상품이 존재하지 않습니다.");
						location.href= "/product/product-list-view";
						return;
					}
					let idMax = listProducts[0].id;
					let idMin = listProducts[0].id;
					
					for(let i=1; i< listProducts.length; i ++){
						let idCurrent = listProducts[i].id;
						//console.log(idCurrent);
						if(listProducts[i].id < idMin){
							idMin = idCurrent
						}
						if(listProducts[i].id > idMax){
							idMax = idCurrent
						}
					}
					//console.log(`${idMax}, ${idMin}`);
					
					document.getElementById("btn-prev-page").setAttribute('data-id-requested', idMax);
					document.getElementById("btn-next-page").setAttribute('data-id-requested', idMin);
				}
				
				function updatePagingIndices(){
					let link = window.location.href;
    				let url = new URL(link.toString());
    				let urlParams = url.searchParams;
    				if(urlParams.has('direction') || urlParams.has('idRequested')){
	  					urlParams.delete('direction');
	  					urlParams.delete('idRequested');
	  				}
    				//console.log(url.toString());
					
					let numberPageCurrent = /*[[${numberPageCurrent}]]*/null;
					let numberPageMax = /*[[${numberPageMax}]]*/null;
					let limit = /*[[${limit}]]*/null;
					let idFirst = /*[[${idFirst}]]*/null;
					let idLast = /*[[${idLast}]]*/null;
					//console.log(`${numberPageCurrent}, ${numberPageMax}, ${limit}`);
					
					let anchors = $(".list-indices-page")[0];
					//console.log(anchors);
					let indexStart = parseInt(numberPageCurrent/5)*5;
					indexStart = indexStart > 0 ? indexStart: 0;
					let indexLast = (parseInt(numberPageCurrent/5) + 1)* 5;
					indexLast = indexLast < numberPageMax ? indexLast : numberPageMax + 1;
					//console.log(`${indexStart}, ${indexLast}`);
					for(let i = indexStart; i < indexLast; i ++){
						let anchor = document.createElement('a');
						
						urlParams.set('pageCurrent', numberPageCurrent);
						urlParams.set('pageRequested', i);
						
						anchor.setAttribute('href', url.toString());
						anchor.classList.add('mx-2');
						if(i == numberPageCurrent){
							anchor.classList.add('font-weight-bold');
						}
						anchor.append(i + 1);
						
						anchors.append(anchor);
					}
					//console.log(anchors);    				
				}
				
    			
    			$(".btn-select-dropdown-specific").on('change', function(e){
    				let link = window.location.href;
    				let url = new URL(link.toString());
    				let urlParams = url.searchParams;

    				if(urlParams.has('direction') || urlParams.has('idRequested')){
	  					urlParams.delete('direction');
	  					urlParams.delete('idRequested');
	  				}
    				
    				let field = $(this).children("option:selected").data('field'); 
    				let value = $(this).children("option:selected").data('value');
    				console.log(`${field}, ${value}`);
    				
					//전체 버튼을 눌렀을 경우 아예 해당 field를 지우고 현재 창 새로고침 하도록 바꿨다.
					if(!value || value == "전체" || value == "---선택---"){
						urlParams.delete(field);
						location.href= url;
						return;
					}
	  				//기존 field가 이미 존재할 때는 Set로
	  				// 존재하지 않으면 append로 값 넣기
	  				if(urlParams.has(field)){
	  					urlParams.set(field, value);
	  				} else {
	  					urlParams.append(field, value);
	  				}
	  				
    				location.href= url;
    			})
    			
    			$(".arrow-paging").on('click', function(e){
    				let link = window.location.href;
    				let url = new URL(link.toString());
    				let urlParams = url.searchParams;
    				
    				let direction = $(this)[0].getAttribute('data-direction');
    				let idRequested = $(this)[0].getAttribute('data-id-requested');
    				
  					urlParams.set('direction', direction);
  					urlParams.set('idRequested', idRequested);
    				
    				console.log(`${direction}, ${idRequested}`);
    				console.log(url);

    				location.href = url;
    				
    			})// arrow-paing on click
    			
    		})//document ready
    	
    	</script>
	</th:block>
	
</html>