<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/defaultLayout}">
      
	<head>
		<title>간식줘집사</title>
	</head>
	<section layout:fragment="contents" class="contents">
		<article class="group-article background-cards-list">
			<div class="groups-dropdown-select">
				<div class="group-dropdown-select">
					<label for="field-agePetProper" class="label-for-select m-0">
						연령별 분류
					</label>
				  	<select id="field-agePetProper" name="agePetProper" class="btn-select-dropdown-specific custom-select">
					    <option data-field="agePetProper">
					    	---선택---
				    	</option>
					    <option data-field="agePetProper">
					    	전체
				    	</option>
					    <option class="under6months" data-field="agePetProper" data-value="under6months">
					    	6개월 미만
				    	</option>
					    <option class="adult" data-field="agePetProper" data-value="adult">
					    	성견
				    	</option>
					    <option class="senior" data-field="agePetProper" data-value="senior">
					    	고령견
				    	</option>
			  		</select>
				</div>
				<div class="group-dropdown-select">
					<label for="field-category" class="label-for-select m-0">
						카테고리
					</label>
				  	<select id="field-category" name="category" class="btn-select-dropdown-specific custom-select">
					    <option data-field="category">
					    	---선택---
				    	</option>
					    <option data-field="category">
					    	전체
				    	</option>
					    <option class="treat" data-field="category" data-value="treat">
					    	간식
				    	</option>
					    <option class="kibble" data-field="category" data-value="kibble">
					    	사료
				    	</option>
			  		</select>
				</div>
			</div>
			<div class="groups-cards-collapsed">
				<div class="groups-product-list">
					<th:block th:each="unit : ${listProducts}">
<!-- 하나의 Card Unit이 320px X 320px; -->
						<div class="unit-card-product">
							<a th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
								<img class="img-unit-list-view" th:src="${unit.imgProfile}" width="270" height="270">
							</a>
							<div class="group-link-from-unit">
								<a class="name-unit-list-view anchor-unit-list-view" th:data-field="name" th:data-value="${unit.name}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.name}"></span>
								</a>
								<a class="category-unit-list-view anchor-unit-list-view" th:data-field="category" th:data-value="${unit.category}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.categoryTranslatedK}"></span>
								</a>
								<a class="agePetProper-unit-list-view anchor-unit-list-view" th:data-field="agePetProper" th:data-value="${unit.agePetProper}" th:href="@{/product/product-detail-view/{productId}(productId=${unit.id})}">
									<span th:text="${unit.agePetProperTranslatedK}"></span>
								</a>
							</div>
						</div>
					</th:block>
			</div>
			</div>
		</article>
</section>

	<th:block layout:fragment="script">
    	<script>
    		$(document).ready(function(e){
    			/* 처음 페이지 로딩 될 때, 해당 옵션 필터들 띄우기; option:selected 노출시키기 */
    			let link = window.location.href;
				let url = new URL(link.toString());
				let urlParams = url.searchParams;
				
				//나중에 여러 Field(Select메뉴)들이 있는 경우, 반복문으로 돌려야!
				let keys = urlParams.keys();
				for(let key of keys){
					let value = urlParams.get(key);
					console.log(`key: ${key}, value: ${value}`);
					let selectCur = $('#field-' + key);
					let optionSelected = $('option.' + value)[0];
					selectCur.find(optionSelected).prop('selected', true);
				}
    			
    			$(".btn-select-dropdown-specific").on('change', function(e){
    				let link = window.location.href;
    				let url = new URL(link.toString());
    				let urlParams = url.searchParams;

    				let field = $(this).children("option:selected").data('field'); 
    				let value = $(this).children("option:selected").data('value');
    				console.log(`${field}, ${value}`);
    				
					//전체 버튼을 눌렀을 경우 아예 해당 field를 지우고 현재 창 새로고침 하도록 바꿨다.
					if(!value || value == "전체" || value == "---선택---"){
						urlParams.delete(field);
						location.href= url;
						return;
					}
	  				//기존 field가 이미 존재할 때는 Set로
	  				// 존재하지 않으면 append로 값 넣기
	  				if(urlParams.has(field)){
	  					urlParams.set(field, value);
	  				} else {
	  					urlParams.append(field, value);
	  				}
    				location.href= url;
    			})
    		})//document ready
    	
    	</script>
	</th:block>
	
</html>