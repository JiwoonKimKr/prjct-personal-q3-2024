<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/adminDefaultLayout}">
    <head>
    	<title>
    		최근 결제완료 주문 조회
    	</title>
    </head>
	<section layout:fragment="contents" class="contents mt-5">
<!-- 
Model Attributes
listInvoices
 -->	
			<article class="group-article ">
	 			<!-- Dropdown: Choosing Field for Searching -->
	 			<div class="bg-info rounded d-flex justify-content-between py-3 px-3">
					<span class="h3 text-white col-3">
						검색 항목
					</span>
					<div class="input-group p-0 col-5">
						<select id="dropDown-for-choosing-field" class="custom-select h-100" aria-label="Example select with button addon">
						    <option selected>--------</option>
						    <option value="field-userId">결제자 ID</option>
						    <option value="field-payment">결제금액</option>
						    <option value="field-paymentType">결제타입</option>
						    <option value="field-company">결제 회사</option>
						    <option value="field-monthlyInstallment">할부 내역</option>
						    <option value="field-hasCanceled">주문 취소 여부</option>
						    <option value="field-buyerName">구매자 이름</option>
						    <option value="field-buyerPhoneNumber">구매자 연락처</option>
						    <option value="field-statusDelivery">배송 현황</option>
						    <option value="field-receiverName">수령자 이름</option>
						    <option value="field-receiverPhoneNumber">수령자 연락처</option>
						    <option value="field-address">배송 주소</option>
						    <option value="field-createdAt">기입 시간</option>
						    <option value="field-updatedAt">수정 시간</option>
						</select>
					</div>
					<div class="d-flex justify-content-end col-4">
						<button class="btn-search btn-danger btn-cancel-register w-100 mr-2">
							SEARCH
						</button>
					</div>	
				</div>
				<!-- 숨겨진 검색 항목별 카테고리들 -->
				<div class="groups-category-for-search" >
					<!-- Dropdown: userId -->
					<div id="field-userId" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							결제자Id
						</span>
						<input id="userId" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: payment -->
					<div id="field-payment" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							결제금액
						</span>
						<input id="payment" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: company -->
					<div id="field-company" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							결제 회사
						</span>
						<input id="company" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: monthlyInstallment -->
					<div id="field-monthlyInstallment" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							할부 내역
						</span>
						<input id="monthlyInstallment" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: hasCanceled -->
					<div id="field-hasCanceled" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							주문 취소 여부
						</span>
						<div class="input-group p-0 col-8">
							<select id="hasCanceled" class="custom-select input-select-inside w-100 h-100" aria-label="Example select with button addon">
							    <option selected>--------</option>
							    <option value="0">결제 완료</option>
							    <option value="1">주문 취소</option>
							</select>
						</div>
					</div>
					<!-- Dropdown: buyerName -->
					<div id="field-buyerName" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							구매자 이름
						</span>
						<input id="buyerName" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: buyerPhoneNumber -->
					<div id="field-buyerPhoneNumber" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							구매자 연락처
						</span>
						<input id="buyerPhoneNumber" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: statusDelivery -->
					<div id="field-statusDelivery" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							배송 현황
						</span>
						<div class="input-group p-0 col-8">
							<select id="statusDelivery" class="custom-select input-select-inside w-100 h-100" aria-label="Example select with button addon">
							    <option selected>--------</option>
							    <option value="PaymentBilled">결제 완료</option>
							    <option value="PackingFinished">배송준비 완료</option>
							    <option value="TerminalHub">터미널 이동</option>
							    <option value="EndPoint">배송 상차</option>
							    <option value="DeliveryCurrent">배송중</option>
							</select>`
						</div>
					</div>
					<!-- Dropdown: receiverName -->
					<div id="field-receiverName" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							수령자 이름
						</span>
						<input id="receiverName" type="text" class="form-control col-8">
					</div>	
					<!-- Dropdown: receiverPhoneNumber -->
					<div id="field-receiverPhoneNumber" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							수령자 연락처
						</span>
						<input id="receiverPhoneNumber" type="text" class="form-control col-8">
					</div>	
					<!-- Dropdown: address -->
					<div id="field-address" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							배송 주소
						</span>
						<input id="address" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: createdAt -->
					<div id="field-createdAt" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							기입 시간
						</span>
						<input id="createdAt" type="text" class="form-control col-8">
					</div>
					<!-- Dropdown: address -->	
					<div id="field-updatedAt" class="d-none bg-secondary rounded justify-content-between py-3 px-3">
						<span class="h3 text-white col-4">
							수정 시간
						</span>
						<input id="updatedAt" type="text" class="form-control col-8">
					</div>	
				</div>
				<!-- 상품 조회 선택항목 끝 -->			
				<!-- 상품 조회 상세 내역 출력_시작 -->
				<div class="mt-5">
					<table class="table-striped table-hover text-center w-100">
						<thead>
							<tr>
								<th>주문<br>고유번호</th>
								<th>유저<br>로그인아이디</th>
								<th>결제 완료<br>시간</th>
								<th>주문<br>취소 여부</th>
								<th>배송 현황</th>
							</tr>
						<thead>
						<tbody id="tableBody">
							<th:block th:each="invoice: ${listInvoices}">
<!-- 
	id
	userId
	payment
	paymentType
	company
	monthlyInstallment
	hasCanceled
	buyerName
	buyerPhoneNumber
	statusDelivery
	receiverName
	receiverPhoneNumber
	address
	createdAt
	updatedAt
 -->								
								<tr>
									<th>
										<button class="btn-invoice-detail btn btn-danger" th:data-id="${invoice.id}" th:data-user-id="${invoice.userId}" th:text="${invoice.id}">
											주문고유번호
										</button>
									</th>
									<th>
										<button class="btn-invoice-detail btn btn-danger" th:data-id="${invoice.id}" th:data-user-id="${invoice.userId}" th:text="${invoice.loginId}">
											결제자 로그인아이디
										</button>
									</th>
									<td th:text="${invoice.updatedAt}"></td>
									<td th:text="${invoice.hasCanceled}"></td>
									<td th:text="${invoice.statusDelivery}"></td>
								</tr>
							</th:block>
						</tbody>
					</table>
				</div>
				
			</article>
	</section>

	<th:block layout:fragment="script">
    	<script th:inline="javascript">
    		$(document).ready(function(){
    			
    			/* admin ProductList.html에서 긁어옴; 수정해야!!! _18:30_06 08 2024 */
    			// RequestParam 어떤 필드 선택되었는지 동적으로 구성하도록 바꿔야!
    			$("#dropDown-for-choosing-field").on('change', function(){
    				/* 검색항목 초기화*/
	    				/* 기존 입력값 초기화 */
    				$("#idProduct").val('');
    				$("#nameProduct").val('');
					$("#categoryProduct").val('');
					$("#priceProduct").val('');
					$("#agePetProperProduct").val('');    				
    				
						/* 보여지던 필드 태그 초기화 */
    				$(".bg-secondary").removeClass("d-flex");
    				$(".bg-secondary").addClass("d-none");
    				$("#tableBody").empty();
    				
    				let fieldChose = $("#dropDown-for-choosing-field").val();
    				console.log(fieldChose);
   				/* jQuery 변수로 ID 얻는 방법; 처음 발견한 방법! */
    				let dropdownChose = $('#' + fieldChose);
    				dropdownChose.removeClass("d-none");
    				dropdownChose.addClass("d-flex");
    			})// #dropDown-for-choosing-field on change
    			
     			$(".btn-search").on('click', function(){
     				/* 기존 검색값 초기화 */
     				$("#tableBody").empty();
     				
    				let id = $("#idProduct").val().trim();
    				let name = $("#nameProduct").val().trim();
					let category = $("#categoryProduct").val();
					let price = $("#priceProduct").val().trim();
					let agePetProper = $("#agePetProperProduct").val();
    				
					if(category == '--------'){
						category = '';
					}
					if(agePetProper == '--------'){
						agePetProper = '';
					}
    				
					console.log(`${id}, ${name}, ${category}, ${price}, ${agePetProper}`);
					
					// 값 하나만 선택해서 넘겨야 
					// 하지만 아무 값도 안 넘어가면 아예 서버에 요청 안 하도록
					if(!id
						&& !name
						&& !category
						&& !price
						&& !agePetProper){
						alert("검색항목 값을 입력하여 주세요");
						location.reload();
						return;
					}
					
					let params = {
									"id": id
									, "name": name
									, "category": category
									, "price": price
									, "agePetProper":agePetProper
								}
					let url = "/admin/product/product-list-view"
					
					$.ajax({
						type: "POST"
    					, url: url
    					, data: params
    					, success:function(data){
							console.log(data);
    						if(data.code == 200){
    							for(let i = 0; i< data.listProducts.length; i++){
    								let strUrlCurrent = '<a href="/admin/product/' + data.listProducts[i].id + '">';
    								let tableTd = '<tr>';
    								tableTd += '<td>' + (i + 1) + '</td>';
    								tableTd += '<td>' + strUrlCurrent + data.listProducts[i].id + '</a></td>';
    								tableTd += '<td>' + strUrlCurrent + data.listProducts[i].name + '</td>';
    								tableTd += '<td>' + data.listProducts[i].price + '</td>';
    								tableTd += '<td>' + data.listProducts[i].category + '</td>';
    								tableTd += '<td>' + data.listProducts[i].agePetProper + '</td>';
    								tableTd += '<td><img src="' + data.listProducts[i].imgThumbnail + '" width="50" height="50"></td>';
    								tableTd += '<td>' + data.listProducts[i].createdAt + '</td>';
    								tableTd += '<td>' + data.listProducts[i].updatedAt + '</td>';
    								tableTd += '</tr>';
    								
    								$('#tableBody').append(tableTd);
    							}
    						}
    					}
    					, error: function(error){
    						alert("상품 조회에 실패하였습니다. 관리자에게 문의하세요.")
    					}
					})					
    			}) // btn-search on click
    			
    		})//document ready
    	
    	</script>
	</th:block>

	
</html>