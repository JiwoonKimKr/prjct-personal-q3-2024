<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/defaultLayout}">
      
	<head>
		<title>ê°„ì‹ì¤˜ì§‘ì‚¬ ì»¤ë®¤ë‹ˆí‹°</title>
	</head>
	<section layout:fragment="contents" class="contents w-100">
		<div class="d-flex justify-content-between w-100">
			<article class="group-article community-cards-list">										
				<div class="bar-search-keyword-community">
					<input class="input-search-community" placeholder=" ğŸ” Search">
					<button class="btn-seartch-community">
						ê²€ìƒ‰
					</button>
				</div>
				<div class="list-articles-latest">
					<div class="card-post-rect-white-rounded-detail">
					 	<p class="pl-5 mb-4" th:text="|${post.nickname}|"></p>
					 	<p class="pl-5 m-0" th:text="|ì œëª©: ${post.title}|"></p>
					 	<p class="pl-5 m-0" th:text="|ë‚´ìš©: ${post.content}|"></p>
					</div>
					<div class="d-flex justify-content-center mr-5 mb-4">
						<button class="btn-update-post" type="button" data-toggle="modal" data-target="#modal-update-current-post">
							<span>ê¸€ ìˆ˜ì •í•˜ê¸°</span>
							<div class="icon-pencil">
								<svg width="28" height="33" viewBox="0 0 28 33" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M2.64819 28.7474L2.97117 31.2777L5.55141 30.3946L2.64819 28.7474Z" fill="white"/>
									<path d="M1.60748 20.5944C1.60748 20.5944 12.2911 3.18904 13.8426 2.09263C18.5191 -1.21203 26.0965 3.67084 26.1006 9.04724C26.1014 9.97501 13.8655 27.549 13.8655 27.549M1.60748 20.5944L13.8655 27.549M1.60748 20.5944L2.64819 28.7474M13.8655 27.549L5.55141 30.3946M2.64819 28.7474L2.97117 31.2777L5.55141 30.3946M2.64819 28.7474L5.55141 30.3946" stroke="white" stroke-width="2"/>
								</svg>
							</div>
						</button>
						<button class="btn-delete-post" type="button">
							ê¸€ ì‚­ì œí•˜ê¸°
						</button>
					</div>
					
<!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ë“¤ -->					
					<div class="groups-list-comments">
						<th:block th:each="comment:${listComments}">
							<div class="card-comment-rect-white-rounded">
								<p class="pl-5 m-0" th:text="|${comment.nickname}: ${#strings.abbreviate(comment.content,25)}|"></p>
							</div>
						</th:block>
					</div>
				</div>
<!-- ê¸€ ìˆ˜ì •í•˜ê¸° modal; #modal-update-current-post-->					
				<div class="modal fade" id="modal-update-current-post" tabindex="-1" role="dialog" aria-labelledby="update-current-post" aria-hidden="true">
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="update-current-post">
									ê¸€ ìˆ˜ì •í•˜ê¸°
								</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">
										&times;
									</span>
								</button>
							</div>
							<div class="modal-body">
								<div id="userName-modal" th:text="|ì‘ì„±ì: ${session.userName}|">
									
								</div>
								<div class="input-group modal-input-rounded">
									<select class="custom-select modal-input-select-inside pl-5 w-100 h-100" id="agePetProper" aria-label="Example select with button addon">
									    <option selected>---ì„ íƒ---</option>
									    <option value="under6months">ìƒí›„ 6ê°œì›” ë¯¸ë§Œ</option>
									    <option value="adult">ì„±ê²¬</option>
									    <option value="senior">ê³ ë ¹ê²¬</option>
									</select>
								</div>	
								<div class="form-group">
									<label for="title-modal" class="col-form-label">
										ì œëª©:
									</label>
									<input id="title-modal" type="text" class="form-control">
								</div>
								<div class="form-group">
									<label for="content-modal" class="col-form-label">
										ë‚´ìš©:
									</label>
									<textarea id="content-modal" class="form-control"></textarea>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">ì·¨ì†Œ</button>
								<button id="btn-update-current-post" type="button" class="btn btn-primary">ìˆ˜ì •í•˜ê¸°</button>
							</div>
						</div>
					</div>
				</div>					
			</article>
		</div>				
	</section>

	<th:block layout:fragment="script">
    	<script th:inline="javascript">
    		$(document).ready(function(e){
    			$("#groups-nav-header").css("background-color", "#ED5178");
    			$(".groups-nav-aside").css("background-color", "#FFE397");

    			$(".btn-filter-field-community").on('click', function(){
    				let field = $(this).data('field');
    				let value = $(this).data('value');
    				
    				console.log(`${field}, ${value}`);
    				let url = "/community/community-main-view?".concat(field).concat('=').concat(value);
    				
    				console.log(url);
    				location.href= url;
    			})// btn-filter-field-community on click
    			
    			$(".btn-update-post").on('click', function(){
    				let title = /*[[${post.title}]]*/null;
    				$("#title-modal").val(title);
    				let content = /*[[${post.content}]]*/null;
    				$("#content-modal").val(content);
    				let agePetProper = /*[[${post.agePetProper}]]*/null;
    				let options = $("#agePetProper").children();
    				for(let option of options){
    					let value = option.getAttribute('value');
    					if(value == agePetProper){
    						option.setAttribute('selected', true);
    					}
    				}
    				console.log(`${title}, ${content}, ${agePetProper}`);
    				
    			})// btn-update-current-post on click
    			
    			$("#btn-update-current-post").on('click', function(){
					let postId = /*[[${post.postId}]]*/null;
    				let title = $("#title-modal").val().trim();
    				let content = $("#content-modal").val().trim();
    				let agePetProper = $("#agePetProper").children("option:selected").val();
    				
    				if(!title){
    					alert("ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    					return;
    				}
    				
    				if(!content){
    					alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    					return;
    				}
    				if(title.length > 30 || content.length > 500){
    					alert("ì œëª©ì˜ ê¸¸ì´ëŠ” 30ì ì´ë‚´, ë‚´ìš©ì€ 500ì ì´ë‚´ë¡œ ì‘ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.")
    					return;
    				}
    				
    				if(agePetProper == '---ì„ íƒ---'){
    					agePetProper = null;
    				}
    				
    				console.log(`${postId}, ${title}, ${content}, ${agePetProper}`)
    				
    				let url = "/community/update-current-post";
    				let params= {"postId": postId
    							, "title": title
    							, "content": content
    							, "agePetProper": agePetProper}
    				
    				if(confirm("í˜„ì¬ ê¸€ì„ ìˆ˜ì •í•˜ê² ìŠµë‹ˆê¹Œ?") == false){
    					console.log("current post get rejected.");
    					return;
    				}
    				
    				$.post(url, params)
    				.done(function(data){
    					if(data.code == 200){
    						alert(data.result);
    						location.reload();
    					} else if(data.code == 403){
    						location.href = "user/sign-in-view";
    					} else {
    						alert(data.error_message);
    					}
    					
    				})//ajax
    			})//btn update current post on click

				$(".btn-delete-post").on('click', function(){
					let postId = /*[[${post.postId}]]*/null;
					
					if(confirm("í•´ë‹¹ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?") == false){
						console.log("current post reject to get deleted. post Id = ${postId}");
						return;
					}
					console.log(postId);
					$.ajax({
					 	type: 'delete'
						, url : "/community/delete-current-post"
						, data : {'postId': postId}
						, success : function(data){
							if(data.code == 200){
								alert("í•´ë‹¹ ê¸€ì„ ì‚­ì œí•˜ì˜€ìŠµë‹ˆë‹¤.")
								location.href="/community/community-main-view";
								return;
							} else if(data.code == 403){
								alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.")
								location.href="/user/sign-in-view";
								return;
							} else {
								alert(data.error_message);
								return;
							}
						}
						, error : function(){
							alert("í•´ë‹¹ ê²Œì‹œê¸€ë¥¼ ì‚­ì œí•˜ì§€ ëª»í•˜ì˜€ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.");
							return;
						}
					})//ajax

				})// btn-delete-post on click

    		})//document ready
    	</script>
	</th:block>
	
</html>